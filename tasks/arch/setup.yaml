- block:
  - name: Get current username
    command: id -un
    register: current_username

  - name: Set global facts
    set_fact:
      distribution: "{{ ansible_distribution }}"
      username: "{{ current_username.stdout }}"
      home_dir: "{{ lookup('env', 'HOME') }}"
      temp_dir: "{{ lookup('env', 'HOME') }}/temp"
      application_dir: "{{ lookup('env', 'HOME') }}/applications"
      personal_dir: "{{ lookup('env', 'HOME') }}/personal"
      work_dir: "{{ lookup('env', 'HOME') }}/work"
      docker_container: "{{ lookup('ansible.builtin.env', 'DOCKER_CONTAINER', default='false') }}"
      dotfiles_dir: "{{ lookup('env', 'HOME') }}/.dotfiles"
      user_bin: "/usr/local/bin"

  - name: Create temporary download directory
    file:
      path: "{{ temp_dir }}"
      state: directory
      mode: '0755'

  - name: Create application directory
    file:
      path: "{{ application_dir }}"
      state: directory
      mode: '0755'

  - name: Display all facts
    debug:
      msg: 
      - "distribution: {{ distribution }}"
      - "username: {{ username }}"
      - "home_dir: {{ home_dir }}"
      - "temp_dir: {{ temp_dir }}"
      - "dotfiles_dir: {{ dotfiles_dir }}"
      - "application_dir: {{ application_dir }}"
      - "personal_dir: {{ personal_dir }}"
      - "work_dir: {{ work_dir }}"
      - "user_bin: {{ user_bin }}"
      - "docker_container: {{ docker_container }}"

  tags:
    - always
